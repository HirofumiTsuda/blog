<!doctype html><html dir=ltr lang=en data-theme class="html theme--light"><head><title>Hirofumi Tsuda
|
Snowflake Architectures: Query Processing</title><meta charset=utf-8><meta name=generator content="Hugo 0.119.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Hirofumi Tsuda"><meta name=description content="A warehouse of my thoughts, ideas and studies"><link rel=stylesheet href=/blog/scss/main.min.1147aa5bacb4bce677a0e264073829caedb82fd18ea07a5f1d80521f539d1c45.css integrity="sha256-EUeqW6y0vOZ3oOJkBzgpyu24L9GOoHpfHYBSH1OdHEU=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/blog/css/markupHighlight.min.73ccfdf28df555e11009c13c20ced067af3cb021504cba43644c705930428b00.css integrity="sha256-c8z98o31VeEQCcE8IM7QZ688sCFQTLpDZExwWTBCiwA=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/blog/fontawesome/css/fontawesome.min.7d272de35b410fb165377550cdf9c4d3a80fbbcc961e111914e4d5c0eaf5729f.css integrity="sha256-fSct41tBD7FlN3VQzfnE06gPu8yWHhEZFOTVwOr1cp8=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/blog/fontawesome/css/solid.min.55d8333481b07a08e07cf6f37319753a2b47e99f4c395394c5747b48b495aa9b.css integrity="sha256-VdgzNIGwegjgfPbzcxl1OitH6Z9MOVOUxXR7SLSVqps=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/blog/fontawesome/css/regular.min.a7448d02590b43449364b6b5922ed9af5410abb4de4238412a830316dedb850b.css integrity="sha256-p0SNAlkLQ0STZLa1ki7Zr1QQq7TeQjhBKoMDFt7bhQs=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/blog/fontawesome/css/brands.min.9ed75a5d670c953fe4df935937674b4646f92674367e9e66eb995bb04e821647.css integrity="sha256-ntdaXWcMlT/k35NZN2dLRkb5JnQ2fp5m65lbsE6CFkc=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/blog/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/blog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=canonical href=http://HirofumiTsuda.github.io/blog/posts/snowflake2/><script type=text/javascript src=/blog/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/blog/js/anatole-theme-switcher.min.d6d329d93844b162e8bed1e915619625ca91687952177552b9b3e211014a2957.js integrity="sha256-1tMp2ThEsWLovtHpFWGWJcqRaHlSF3VSubPiEQFKKVc=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Snowflake Architectures: Query Processing"><meta name=twitter:description content><meta property="og:title" content="Snowflake Architectures: Query Processing"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="http://HirofumiTsuda.github.io/blog/posts/snowflake2/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-28T09:16:47+09:00"><meta property="article:modified_time" content="2023-12-28T09:16:47+09:00"><meta property="og:site_name" content="Coffee, Codes, Mathematics and Heavy Metal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Snowflake Architectures: Query Processing","headline":"Snowflake Architectures: Query Processing","alternativeHeadline":"","description":"
      
        


      


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/HirofumiTsuda.github.io\/blog\/posts\/snowflake2\/"},"author":{"@type":"Person","name":"Hirofumi Tsuda"},"creator":{"@type":"Person","name":"Hirofumi Tsuda"},"accountablePerson":{"@type":"Person","name":"Hirofumi Tsuda"},"copyrightHolder":{"@type":"Person","name":"Hirofumi Tsuda"},"copyrightYear":"2023","dateCreated":"2023-12-28T09:16:47.00Z","datePublished":"2023-12-28T09:16:47.00Z","dateModified":"2023-12-28T09:16:47.00Z","publisher":{"@type":"Organization","name":"Hirofumi Tsuda","url":"http://HirofumiTsuda.github.io/blog/","logo":{"@type":"ImageObject","url":"http:\/\/HirofumiTsuda.github.io\/blog\/favicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"http:\/\/HirofumiTsuda.github.io\/blog\/posts\/snowflake2\/","wordCount":"538","genre":["tech"],"keywords":["snowflake","architectures"]}</script></head><body class=body><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/blog/assets/images/profile/profile.jpeg alt="profile picture"><div class=sidebar__introduction-title><a href=/blog>Coffee, Codes, Mathematics and Heavy Metal</a></div><div class=sidebar__introduction-description><p>A warehouse of my thoughts, ideas and studies</p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://www.linkedin.com/in/hirofumitsuda23/ target=_blank rel="noopener me" aria-label title><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
Hirofumi Tsuda
2024</li></ul></footer><script type=text/javascript src=/blog/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu><li class=nav__list-item><a href=/blog/ title>Home</a></li><li class=nav__list-item><a href=/blog/posts/ title>All Posts</a></li><li class=nav__list-item><a href=/blog/categories/ title>Categories</a></li><li class=nav__list-item><a href=/blog/tags/ title>Tags</a></li></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__content><h1>Snowflake Architectures: Query Processing</h1><h2 id=introduction>Introduction</h2><p>In <a href=http://HirofumiTsuda.github.io/blog/posts/snowflake1/>the previous post</a>, a service called <code>Could Service</code> has been shown. That service does not execute queries although result cache and metadata are managed there.
Here another service called <code>Query Processing</code> is shown and this service is where queries are processed and executed.</p><p>As shown in <a href=https://docs.snowflake.com/en/user-guide/cost-understanding-compute>this article</a>, costs of Snowflake heavily depend on computing. To reduce those costs, it is necessary to understand this Query Processing service.</p><p>The core of this Query Processing service is a warehouse. Let us start with a warehouse.</p><h2 id=abstract-of-warehouse>Abstract of Warehouse</h2><p>A warehouse is where queries are processed and executed. On AWS, it means EC2 instances (Snowflake does not publish what instance type is used though).
As a parameter assigned to a warehouse, a size is what you have to choose. Its size follows ones of T-shirts like XS, S and M&mldr; Once you choose an one size larger warehouse,
then the speed to process and execute queries would be twice faster than one of an one size smaller warehouse.</p><p>From the above explanations, you may think it is the best way to choose the warehouse with the maximum size. However, there are three facts to be known.</p><ul><li>Using an one size larger warehouse means costs get twice larger.</li><li>Costs involving a warehouse depend on how long the warehouse has been on (not depend how lond the warehouse has worked!)</li><li>The minimum duration for calculating costs is 1 minute. Even if a warehouse has been on for less than 1 minute, the cost is calculated as one for 1 minute.</li></ul><p>The first fact is the relation between a size and a cost. Since using an one size larger warehouse leads to achieve twice faster processing-speed (time taken to process a query would get half), the total cost would not change a lot by changing a warehouse. The total cost for a query mainly depends on the query itself.</p><p>Second, the costs for a warehouse is calculated based on how long the warehouse has been on. If a warehouse does not process any queries but is on, a cost is incurred.
One tip to deal with reducing such a cost is using the shutdown and resume services. On Snowflake, a shutdown function is provided and using that a warehouse gets down while no queries are submitted. Once a query is submitted to the warehouse, that gets turned on (the resume function).
While that warehouse sleeps, no costs are incurred.</p><p>Finally, the minimum duration is 1 minute. If you don&rsquo;t use a warehouse for less than 1 minute, it is considered that you use that warehouse for 1 minute.
Therefore it is necessary to pay attention to execute a query taking short time.</p><h2 id=local-cache-at-warehouse>Local Cache at Warehouse</h2><p>A warehouse has its own local cache. When a query is processed intermediated results are put on the cache. Those data are used for processing queries and that leads to achieve faster processing than one without using any cache (cold-start).
Those data on a cache gets invalid when the warehouse turns off.</p><h2 id=conclusion>Conclusion</h2><p>It is important to know about warehouses to guess costs mainly incurred for snowflake.</p><p>Abstracts of two architectures have been seen so far. The remaining <code>Database Storage</code> architecture would be shown next.</p></div><div class=post__footer><span><a class=category href=/blog/categories/tech/>tech</a></span>
<span><a class=tag href=/blog/tags/snowflake/>snowflake</a><a class=tag href=/blog/tags/architectures/>architectures</a></span></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
Hirofumi Tsuda
2024</li></ul></footer><script type=text/javascript src=/blog/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></body></html>